# 浏览器缓存

## 1.浏览器缓存机制

在浏览器初次加载资源时，服务器返回200，浏览器从服务器上下载资源，并缓存资源和响应头，供下次加载时对比与使用

在浏览器二次请求资源时，由于强缓存策略，会比较当前时间与上一次返回200时的时间差：

+   如果没有超过cache-control设置的max-age，就表明是没有过期的，则直接从本地读取资源
+   如果过期了，就开始协商缓存，向服务器发送带有`If-None-Match`和`If-Modified-Since`请求，服务器收到`If-None-Match`携带的Etag信息后，进行判断文件有没有被修改，Etag的值一致则没有修改，则命中协商缓存，返回304，如果不一致则带上新资源和新的Etag并返回200
+   如果服务器没有收到Etag值，则将`If-Modified-Since`和被请求文件的最后修改时间做对比，一致则命中协商缓存，返回304，否则带上新的`last-modified`和资源文件返回200

## 2.强缓存和协商缓存的区别

强缓存策略和协商缓存策略在缓存命中时都会直接使用本地的缓存副本，区别只在于协商缓存会向服务器发送一次请求。

它们缓存不命中时，都会向服务器发送请求来获取资源。浏览器首先会根据请求的信息判断强缓存是否命中，如果命中则直接使用资源。

如果不命中则根据头信息向服务器发起请求，使用协商缓存，如果协商缓存命中的话，则服务器不返回资源，浏览器直接使用本地资源的副本，如果协商缓存不命中，则浏览器返回最新的资源给浏览器。

## 3.为啥要使用缓存

-   减少了服务器的负担，提高了网站的性能
-   加快了客户端网页的加载速度
-   减少了多余网络数据传输