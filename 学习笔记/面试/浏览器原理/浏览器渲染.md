# 浏览器渲染

## 1.浏览器渲染流程

+   首先收到需要解析的文档，通过渲染引擎内部的HTML解析器将字节流解析为一个个Token，再将一个个Token解析为DOM节点再将DOM节点添加到DOM树，以此构建出DOM树
+   然后对CSS进行解析，构建CSS规则树
+   根据DOM树和CSS树规则构建渲染树。其中display:none的节点不会显示在渲染树上，还有一些不会渲染输出的节点也不会在渲染树上，比如script、mate等
+   根据渲染树进行回流，遍历节点计算每个节点在视口中的几何信息，例如位置、大小
+   根据渲染树节点的样式和得到的几何信息，转换得到节点的像素，调用相关的API通知GPU进行绘制

## 2.浏览器渲染优化

渲染优化可以从减少回流和重绘、GPU加速、改变script、style引入方式、DOM操作等几个方面来优化

+ 避免将script标签写在body中间，阻塞页面解析
+   GPU加速通常表现在CSS动画中，使用CSS3硬件加速，可以让transform、opacity、filters这些动画不会引起回流重绘，但是如果采用过多的GPU加速会导致内存占用过高，具有性能问题，同时GPU渲染的字体没法抗锯齿，会导致字体在加速期间模糊
+   通过异步的方式引入script标签，避免因为阻塞DOM，同时如果css较少建议直接写在style标签中，如果想导入也避免使用`@import`而采用`link`，可以将link标签的`rel`属性设置为`preload`指明哪些资源是在页面加载完成后即刻需要的
+   减少回流和重绘：
    +   不要使用table布局，因为一个小的改动都可能会使整个table重新布局
    +   尽量通过动态添加类名的方式去修改样式，避免样式多次修改而造成多次回流
    +   可以先设置`display:none`在对DOM进行样式修改，修改完再将他显示出来
    +   对于一些经常变动的DOM，可以让其脱离文档流
    +   还可以使用文档片段，在文档片段里应用DOM操作，最后将他添加进DOM树中
    +   避免在修改样式时，访问获取一些会清空渲染队列(记录引起回流和重绘的操作)的属性
    +   将读操作放在一起，写操作放在一起，便于渲染队列的批处理

