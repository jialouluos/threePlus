# 虚拟DOM

## 1. 对虚拟 DOM 的理解？虚拟 DOM 主要做了什么？虚拟 DOM 本身是什么？

虚拟DOM实际上就是一个js对象,它用来表示DOM的结构，在React中调用render函数，通过React.createElement创建的就是虚拟DOM.Fiber的实现也是通过虚拟DOM来实现的。

采用虚拟DOM，可以一次性的将DOM修改的结果更新到页面上，减少对页面渲染和重绘重排的次数，提高性能，还可以避免手动操作DOM带来的一些问题，同时也可以更好的跨平台，比如nodejs中就没有DOM，这时候可以采用js对象形式的虚拟DOM去实现一些功能

在每次数据发生变化前，虚拟DOM都会在内存中缓存一份，这样变化的时候，就可以通过diff去新旧对比提高效率。

## 2. React diff 算法的原理是什么？

React diff其实就是一个老Fiber树和新React.Element树对比的算法，他做出了一些限制去优化算法的复杂度，只对同级的节点进行Diff，如果一个DOM节点在前后两次更新中跨越了层级，React不会去复用他，还有就是比如如果一个div变为了p，那么React会销毁div和他的子孙节点，再新建p节点和p的子孙节点，通过key(开发者和底层会使用)和tag(底层会使用)去识别出是移动的节点还是真正需要更新的节点，并打上EffectTag，再后续commit阶段的操作中被处理掉。它通过以记录断点的形式去完成3次遍历，3次遍历分别对应更新、新增、移动，同时中间也会穿插着一些删除的操作。

## 3. React key 是干嘛用的 为什么要加？key 主要是解决哪一类问题的

key是追踪元素的一个标识，方便React在Diff阶段通过key值去找到真正需要更新的节点，提高效率。key值的选取一般不建议使用数组下标，因为可能会造成一些错位而导致渲染出来的结果出现问题，比如通过数组map去生成数个输入框，如果通过数组下标去进行key标识，当输入框中输入了值时，再新增一个输入框，可能会导致原来输入框的内容变到了新增输入框中去

## 4. 虚拟 DOM 的引入与直接操作原生 DOM 相比，哪一个效率更高，为什么

直接操作原生DOM效率比虚拟DOM高，因为虚拟DOM对比原生DOM操作，还多了一层虚拟DOM的计算，但是虚拟DOM的优点在于它能够提供能高效的开发模式，同时还可以给我们保持一个不错的性能

## 5. React 与 Vue 的 diff 算法有何不同？

React的diff采用记录断点，3次遍历分别处理更新、新增、移动，中间和末尾穿插删除，比较key和tag(节点类型)，对于需要更新的节点打上Tag，收集，最后commit阶段再统一处理

Vue的diff采用双端遍历，除了比较key和tag之外还比较属性，对于节点采用边对比边更新的方式

相同点 都不推荐使用index作为key，对比算法复杂度都为O(n)，比较时只比较同一层级节点，都是操作虚拟DOM，最小化的去操作真实DOM，提高性能
