# 顶点封装对象

Three.js通过`BufferAttribute`对象对顶点数据进行了封装，该对象`.array`属性的值就是一个存储了一系列顶点数据的数组。 `BufferAttribute`对象可以表示一组顶点位置数据，可以表示一组顶点法向量数据，可以表示一组顶点颜色数据...

Three.js构造函数`BufferAttribute`的名字由Buffer和attribute两个单词组成，顶点数据需要传入WebGL API`gl.createBuffer()`创建顶点缓冲区中，这是`BufferAttribute`类名Buffer部分的来源，顶点数据在着色器代码中对应了attribute变量，比如`attribute vec4 position;`声明了一个顶点位置变量，对应缓冲区中的顶点位置数据；`attribute vec4 normal;`声明了一个顶点法向量变量，对应顶点缓冲区中的顶点颜色数据，这是`BufferAttribute`类名Attribute部分的来源，`BufferAttribute`对象可以翻译为顶点缓冲属性对象。

## BufferAttribute

+   构造函数

    ```js
    constructor( array, itemSize, normalized ) {
        //可以通过构造函数BufferAttribute参数设置.array和.itemSize属性，也可以直接设置这两个属性的值。
        if ( Array.isArray( array ) ) {
            throw new TypeError( 'THREE.BufferAttribute: array should be a Typed Array.' );
        }
        this.name = '';
        this.array = array;//储存了一系列顶点的数组
        this.itemSize = itemSize;// 设置多少个元素为一组，与WebGL的一个方法gl.vertexAttribPointer()第二个参数相关。
        // 比如UV坐标只有xy，需要设置itemSize=2，比如顶点坐标只设置xy，z使用系统默认值，也可以只设置itemSize=2
        this.count = array !== undefined ? array.length / itemSize : 0;//顶点数量
        this.normalized = normalized === true;//是否归一化
        this.usage = StaticDrawUsage;
        this.updateRange = { offset: 0, count: - 1 };
        this.version = 0;
    }
    //EG:
    const points =new Float32Array([
        1,0,0,
        0,1,0,
        0,0,1,
        1,1,0
        0,1,1
        1,0,1
    ])
    const bufferdata = new THREE.BufferAttribute(points,3);
    ```

+   fromBufferAttribute

    ```js
    fromBufferAttribute( attribute, index, offset ) {
    		if ( offset !== undefined ) {
    			console.warn( 'THREE.Vector3: offset has been removed from .fromBufferAttribute().' );
    		}
    		this.x = attribute.getX( index );
    		this.y = attribute.getY( index );
    		this.z = attribute.getZ( index );
    		return this;
    	}
    ```

## BufferGeometry

+   一个几何体对象`BufferGeometry`可以理解为所有种类顶点数据的一个集合，`BufferGeometry`对象`.attributes`的属性包含了所有顶点数据，通过`BufferGeometry.attributes.position`设置或返回顶点位置数据，通过`BufferGeometry.attributes.uv`设置或返回顶点UV坐标数据，通过`BufferGeometry.attributes.normal`设置或返回顶点法向量数据等等。`.attributes.position`、`.attributes.uv`、`.attributes.normal`的属性值都是包含顶点数据的`BufferAttribute`对象
+   创建特定几何形状的缓冲类型API的基类都是`BufferGeometry`,比如`BoxBufferGeometry`,这些API本质上都是通过一定的算法自动化生成各种几何形状对应的顶点数据。

+   ```js
    var geometry = new THREE.BoxBufferGeometry(100, 100,100);
    console.log('几何体所有顶点数据',geometry.attributes);
    console.log('几何体顶点位置数据',geometry.attributes.position);
    console.log('几何体顶点法向量数据',geometry.attributes.normal);
    console.log('几何体顶点索引数据',geometry.index);
    ```

