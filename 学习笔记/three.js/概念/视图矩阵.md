# 视图矩阵

## 概念

+   视图矩阵ViewMatrx,它用来表示由相机构建出来的一个坐标系。在世界坐标系中的物体，我们需要将其变换到相机坐标系中才能够显示出来。我们的目的就说将世界坐标系的东西变换到相机坐标系中，以相机Camera中心点做世界的原点，**Camera的基向量**做世界坐标系的轴

+   观察矩阵是相机本身变换的逆变换

+   公式：ViewMatrx = M~R~^-1^M~T~^-1^，其中M~R~代表一个旋转矩阵，M~T~代表一个位移矩阵

+   原来的世界坐标系的向量都应该先除去当前世界坐标的基向量影响

+   我们把Camera以某种姿态放在世界坐标系中的某个地方，这个放的过程就是对应Camera的旋转和平移，这里表示为TR，其中T表示平稳变换矩阵，R表示旋转变换矩阵。 我们虽然设置的是Camera，但最终动的是点坐标，因为Camera压根就不存在，是一个假想的东西。假设我们不动摄像机，动坐标点，那么对坐标点的变换就应该是对相机变换的逆变换`R^-1T^-1`（就是对TR整体求逆矩阵），注意，这里的`R^-1T^-1`看起来貌不惊人，实际上就是我们要求的View Matrix。 

+   对于一个相机来说，它在开始的时候和世界坐标系是重合的，用户控制相机在世界空间中移动之后，相机的状态可以用两个属性来描述——朝向和位置。也就是说，有了这两个属性，一个相机模型在世界中的状态就确定了。而这两个属性，我们用变换的理论来描述，就是旋转和平移。可以想象，对于世界中的任何一个相机状态，我们都可以把它看成是：相机先围绕自身基原点旋转一定的角度，然后平移到世界空间的某个地方。下图展示了这个过程

    ![img](http://jialouluoblog.oss-cn-hongkong.aliyuncs.com/Images/3213272-cam_xform.jpg)

    图中，红色是相机的基，而黑色是世界的基，也就是参考系。小人是世界中的一个物体。相机在移动之前，两个基是重合的。当相机在屏幕中定位时，它首先会进行朝向的确定——旋转，然后进行位置的确定——平移。图中的Rotation和Translation两步就是相机定位时所发生的变换。可以看到相机相对于小人的运动。而当进行相机变换的时候，小人应该从世界基变换到相机的基里面。这样，他应该进行一个相机定位的逆定位，先逆平移小人和相机，然后再逆旋转小人和相机，最后相机归位，小人随相机变到了相机空间。这是由Inverse Translation和Inverse Rotation两个步骤完成的，这两个步骤就是相机变换。相机定位时所发生的变换矩阵 =  M~T~M~R~，相机变换矩阵 Matrix = ( M~T~M~R~)^-1^ = M~R~^-1^M~T~^-1^

## Camera的基向量(u,v,n)

$$
n可以理解为z轴\\
视点(eye)的坐标减去焦点的坐标(target)得到一个指向视点的方向向量，再将该向量归一化。得到一个模长为1的基向量\\
u可以理解成x\\
将up向量和n向量进行叉乘，来得到一个垂直于【up与n向量构成的平面】的向量，再将该向量归一化。得到一个模长为1的基向量\\
v可以理解成y\\
由于up所代表的方向向量可能与n不垂直，所以将n与u叉乘的结果替代up方向的方向向量\\
这样n,u,v三个方向向量两两互为标准正交基。\\
三向量构成相机坐标系
$$



## M~T~^-1^


$$
该矩阵是一个位移矩阵，假设相机的视点坐标为(Ex,Ey,Ez),相机朝向Up(0,1,0),焦点方向(Tax,Tay,Taz).\\
    视图矩阵同样也可以分为平移、旋转和缩放，视图矩阵是将观察者视为一个模型\\
    获得观察者在世界中变换的模型矩阵的逆矩阵。\\
    观察者平移了（tx，ty，tz）,如果将视图矩阵看作整个世界的模型矩阵，相当于整个世界平移了（-tx，-ty，-tz）。\\
    为了得到视图矩阵，第一步我们需要将两个坐标系(世界坐标系和相机坐标系)的原点移到同一个位置，即让两个原点重合\\
    相机视点为(Ex,Ey,Ez)\\对应的矩阵为M1\begin{bmatrix}
       1 & 0 & 0 & Ex \\
       0 & 1 & 0 & Ey \\
       0 & 0 & 1 & Ez \\
       0 & 0 & 0 & 1  \\ 
      \end{bmatrix}\\M1的逆矩阵为\begin{bmatrix}
       1 & 0 & 0 & -Ex \\
       0 & 1 & 0 & -Ey \\
       0 & 0 & 1 & -Ez \\
       0 & 0 & 0 & 1  \\ 
      \end{bmatrix}\\
    为了让两个坐标系的原点重合，我们需要使用M1的逆矩阵\\
$$


## M~R~

$$
该矩阵是一个旋转矩阵。使用UVN系统来描述相机\\
由于我们已经得到了n,u,v，所以我们开始构造旋转矩阵\\
 M2 = \begin{bmatrix}
    u.x & v.x & n.x & 0 \\
    u.y & v.y & n.y & 0 \\
    u.z & v.z & n.z & 0 \\
     0  &  0  &  0  & 1 \\ 
   \end{bmatrix}\\
   M2的逆矩阵为
   \begin{bmatrix}
    u.x & u.y & u.z & 0 \\
    v.x & v.y & v.z & 0 \\
    n.x & n.y & n.z & 0 \\
     0  &  0  &  0  & 1 \\ 
   \end{bmatrix}\\M2的逆矩阵即为所求
$$

 

## 总结

**所以对于一个处于世界坐标系的向量坐标(v)，如果我们需要得到它在相机坐标系的向量坐标(v')，则 v' = M~R~^-1^M~T~^-1^v**